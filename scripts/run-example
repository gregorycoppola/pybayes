#!/bin/bash
# Usage: ./scripts/run-example socrates

set -e

WORLD="uv run --project /Users/greg/mono/logic/world python -m world.cli.main"
EXAMPLE="$1"

if [ -z "$EXAMPLE" ]; then
    echo "Usage: ./scripts/run-example <example-name>"
    echo "Available examples:"
    ls -1 examples/
    exit 1
fi

DIR="examples/$EXAMPLE"

if [ ! -d "$DIR" ]; then
    echo "Example not found: $DIR"
    exit 1
fi

# Load document
DOC_FILE="$DIR/input.doc"
if [ ! -f "$DOC_FILE" ]; then
    echo "Missing: $DOC_FILE"
    exit 1
fi

TEXT=$(cat "$DOC_FILE")
echo "Document: $TEXT"
echo ""

# Add doc and capture ID
RESULT=$($WORLD doc add "$TEXT")
DOC_ID=$(echo "$RESULT" | grep -oE '[a-f0-9]{12}')
echo "Created: $DOC_ID"
echo ""

# Run doc-level layers
$WORLD layer run "$DOC_ID" --all

# If KB exists, load it and run grounding
KB_FILE="$DIR/kb.logic"
if [ -f "$KB_FILE" ]; then
    echo ""
    echo "Loading KB: $KB_FILE"
    KB_RESULT=$($WORLD kb add "$KB_FILE" --name "$EXAMPLE")
    echo "$KB_RESULT"
fi

echo ""
$WORLD doc json "$DOC_ID"
